# Результат выполнения тестового задания

## Описание:
> Использован ваш шаблон [btlz-wb-test](https://www.google.com/url?q=https://github.com/lucard17/btlz-wb-test&sa=D&source=editors&ust=1759209761976557&usg=AOvVaw2stfgp2mFO1kL02czKfaG6).
>
> При первом запуске приложения запускаются миграции и сиды. Создаются две таблицы `spreadsheets` `tarrifs`.
> 
> Node js приложение имеет эндпоинт, который получает тарифы из API WB `https://common-api.wildberries.ru/api/v1/tariffs/box` и сохраняет их в БД postgres в таблицу `tariffs` с помощью knex.
>
> К сожалению за эти три дня не получилось реализовать сохранение в google таблицу - проблемы с авторизацией OAUTH2

## Запуск:

1. Создать и заполнить свои данные в переменные окружения .env
2. Запуск приложения вместе с БД `docker compose up -d --build`
3. Чтобы проверить работу приложения сделайте запрос GET `http://localhost:5000/health` должно придти `ок`
4. Для того чтобы проверить работу получения данных по api “Тарифы коробов” и сохранения их в БД сделайте GET запрос в `http://localhost:5000/tariffs`

## Что сделано:

### Инфраструктура
- [x] Настроить Docker и подготовить compose файл
- [x] Подготовить миграции для базы данных
- [x] Настроить подключение к PostgreSQL через knex
- [x] Создать структуру приложения с TypeScript
- [x] Настроить сборку и запуск в контейнерах

### Работа с данными Wildberries
- [x] Разобрать структуру данных API "Тарифы коробов"
- [x] Выбрать разумную форму хранения данных в БД
- [x] Создать таблицу `tariffs` для хранения тарифов
- [x] Написать логику для получения данных по API WB
- [x] Реализовать парсинг числовых значений с запятыми

### Обновление данных
- [x] Реализовать ежечасное получение данных по API
- [x] Настроить накопление данных в БД для каждого дня
- [x] Реализовать обновление существующих данных за текущий день

### API и управление
- [x] Добавить эндпоинт (`/health`) для проверки запуска приложения
- [x] Создать эндпоинт для ручного обновления тарифов (`/sheets`)
- [x] Реализовать обработку ошибок и логирование
- [x] Настроить автоматическое обновление каждые 2 часа через `node-cron`

### Google Sheets интеграция
- [x] Добавить таблицу `spreadsheets` для хранения ID таблиц
- [x] Настроить OAuth аутентификацию с Google Sheets API
- [x] Настроить сортировку по возрастанию коэффициента
- [x] Создать лист `stocks_coefs` для тарифов
- [ ] Создать механизм доставки данных в Google таблицы
- [ ] Реализовать обновление данных в таблицах
